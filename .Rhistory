obs_days_complete$tavgl_left_pred_sd  <- predict(mod_tavg_low_cum_sd,
newdata = obs_days_complete)
# based on the predictions give a predicted 95%CI
obs_days_complete <- obs_days_complete %>%
ungroup() %>%
mutate( tavgcum_pred_lwr = tavgl_left_pred - 1.96 * tavgl_left_pred_sd,
tavgcum_pred_upr = tavgl_left_pred + 1.96 * tavgl_left_pred_sd,
spent_tavg = Spent / tavg_low_cumul,
gas_left = 1730 - 0.4*(365 - day_in_wint) - Spent,
#tavgcum_left = tavgcum_total_pred - tavg_low_cumul,
spent_tavg_left_mean = gas_left/ (tavgl_left_pred ),
spent_tavg_left_upr = gas_left / (tavgcum_pred_upr),
spent_tavg_left_lwr = gas_left / (tavgcum_pred_lwr)
)
obs_days_complete %>%
filter(as.numeric(ywint) > 25) %>%
ggplot(aes(x = day_in_wint,
y = spent_tavg,
group = ywint,
color = ywint
)) +
theme_bw() +
geom_line(linewidth=1.5) +
scale_y_continuous(limits = c(-.1, 2))
# start of the heating season
ywint_lim <- 29
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
# start of the heating season
ywint_lim <- 31
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
# start of the heating season
ywint_lim <- 27
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
# start of the heating season
ywint_lim <- 26
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
# start of the heating season
ywint_lim <- 25
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
# start of the heating season
ywint_lim <- 30
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
# start of the heating season
ywint_lim <- 31
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
# give january 5 alternative deadline specific line
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = . %>% filter(day_in_wint == 5))
)
# give january 5 alternative deadline specific line
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 5))
)
View(obs_days_complete)
# give january 5 alternative deadline specific line
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157))
)
View(obs_days_complete)
# give january 5 alternative deadline specific line
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul
)
View(obs_days_complete)
# give january 5 alternative deadline specific line
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul,
gas_left_jan = 1730 - 0.4*(365 - 157) - Spent
)
View(obs_days_complete)
# give january 5 alternative deadline specific line
jan_gasvals <- obs_days_complete %>%
filter(day_in_wint == 157) %>%
select(Meter,Spent,Date) %>%
as.matrix()
View(jan_gasvals)
# give january 5 alternative deadline specific line
jan_gasvals <- obs_days_complete %>%
filter(day_in_wint == 157) %>%
select(Meter,Spent,Date)
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul,
# Meter - jan_gasvals latest gas value
gas_left_jan = jan_gasvals %>% filter( Date < Date[1]) %>% pull(Meter) -
jan_gasvals$Spent
)
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul,
# Meter - jan_gasvals latest gas value
gas_left_jan = jan_gasvals %>% filter( Date < Date) %>% pull(Meter) -
jan_gasvals$Spent
)
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul,
# Meter - jan_gasvals latest gas value
gas_left_jan = jan_gasvals %>% filter( Date < Date) %>% pull(Meter)
)
# give january 5 alternative deadline specific line
jan_gasvals <- obs_days_complete %>%
filter(day_in_wint == 157) %>%
select(Meter,Spent,Date)
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul) %>%
rowwise() %>%
mutate(
# Meter - jan_gasvals latest gas value
gas_left_jan = jan_gasvals %>% filter( Date < Date) %>% pull(Meter)
)
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul) %>%
rowwise() %>%
mutate(
# Meter - jan_gasvals latest gas value
Date2 = Date,
gas_left_jan = jan_gasvals %>% filter( Date < Date2) %>% pull(Meter)
)
obs_days_complete$gas_left_jan <- NA
for (i in 1:nrow(obs_days_complete)) {
act_yr <- year(obs_days_complete$Date[i])
act_last_meter <- jan_gasvals$Meter[act_yr == year(jan_gasvals$Date)]
}
jan_gasvals$Meter[act_yr == year(jan_gasvals$Date)]
View(jan_gasvals)
View(obs_days_complete)
obs_days_complete$gas_left_jan <- NA
for (i in 1:nrow(obs_days_complete)) {
act_yr <- year(obs_days_complete$Date[i])
act_last_meter <- jan_gasvals$Meter[act_yr == year(jan_gasvals$Date)]
obs_days_complete$gas_left_jan[i] <- 1730 - obs_days_complete$Meter[i] - act_last_meter
}
i
act_last_meter
length(act_last_meter)
obs_days_complete$gas_left_jan <- NA
for (i in 1:nrow(obs_days_complete)) {
act_yr <- year(obs_days_complete$Date[i])
act_last_meter <- jan_gasvals$Meter[act_yr == year(jan_gasvals$Date)]
if (length(act_last_meter) == 1) {
obs_days_complete$gas_left_jan[i] <- 1730 - obs_days_complete$Meter[i] - act_last_meter
}
}
View(obs_days_complete)
obs_days_complete$gas_left_jan <- NA
for (i in 1:nrow(obs_days_complete)) {
act_yr <- year(obs_days_complete$Date[i])
act_last_meter <- jan_gasvals$Meter[act_yr == year(jan_gasvals$Date)]
if (length(act_last_meter) == 1) {
obs_days_complete$gas_left_jan[i] <- 1730 - obs_days_complete$Meter[i] +
act_last_meter
}
}
View(obs_days_complete)
plot(obs_days_complete$gas_left_jan)
# give january 5 alternative deadline specific line
jan_gasvals <- obs_days_complete %>%
filter(day_in_wint == 157) %>%
select(Meter,Spent,Date)
# Get the m3 remaining if jan 5 was the deadline (<10sec)
obs_days_complete$gas_left_jan <- NA
for (i in 1:nrow(obs_days_complete)) {
act_yr <- year(obs_days_complete$Date[i])
act_last_meter <- jan_gasvals$Meter[act_yr == year(jan_gasvals$Date)]
# If not in first year where no prev. values are present
if (length(act_last_meter) == 1) {
obs_days_complete$gas_left_jan[i] <- 1730 - obs_days_complete$Meter[i] +
act_last_meter
}
}
# Calculate the suggested rate of burn
obs_days_complete <- obs_days_complete %>%
mutate( tavgl_left_jan = predict(mod_tavg_low_cum_mean,
newdata = data.frame(day_in_wint = 157)) -
tavg_low_cumul,
spent_tavg_left_jan = gas_left_jan / (tavgl_left_jan),
)
View(obs_days_complete)
# start of the heating season
ywint_lim <- 31
date_limits <-
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
arrange(day_in_wint) %>%
.[60, ] %>%
pull(Date) %>%
year() %>%
paste0(.,"-08-01") %>%
as.POSIXct() %>%
rep(.-1, 2)
date_limits[2] <- date_limits[2] + 365*24*3600
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_jan), color = "salmon4",
linetype="dotted", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_jan), color = "salmon4",
linetype="line", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
obs_days_complete %>%
filter(ywint == ywint_lim) %>%
ggplot(aes(x = Date,
y = spent_tavg,
color = gas_left
)) +
theme_bw() +
# color scale until 0
scale_color_gradient(high = "blue", low = "green"
, limits = c(0,1730)
) +
geom_line(linewidth=1.5) +
geom_line(aes(y = spent_tavg_left_mean), color = "grey50",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y =  spent_tavg_left_lwr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_upr), color = "grey70",
linetype="dashed", linewidth = 1.2) +
geom_line(aes(y = spent_tavg_left_jan), color = "salmon4",
linetype="solid", linewidth = 1.2) +
scale_y_continuous(limits = c(0, 1)) +
# date scale (posixct) 1 year
scale_x_datetime(date_breaks = "1 month", date_labels = "%b",
limits = date_limits) +
labs( x = "", y = "Average gas consumption m3/°C")
